name: IDK what I am doing honestly
run-name:  Bottle üöÄ Updateinfo
on: 
  schedule: 
  - cron: "0 0 * * 0"
  workflow_dispatch: 
jobs:
  GetFile:
    runs-on: ubuntu-latest
    steps:
      - name: Install packages
        run: |
          sudo apt-get update
          sudo apt-get install -y libxml2-utils wget gzip git
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - name: Get updateinfo.xml file
        run: |
         wget https://advisories.bottlerocket.aws/updateinfo.xml.gz
         gunzip -f updateinfo.xml.gz
      - name: xmillint the file 
        run: |
          /usr/bin/xmllint --format ./updateinfo.xml > ./updateinfo.txt
          ls ./
          pwd
      - name: Push Repo
        run: |
          cd ${{ github.workspace }}
          diff -q ./updateinfo.txt ./updateinfo.xml
          if [[ $? -eq 1 ]]; then  
            cp ./updateinfo.txt ./updateinfo.xml
            rm ./updateinfo.txt
            git add . 
            git config --global user.name 'Ugly'
            git config --global user.email 'uglie@users.noreply.github.com'
            git commit -am "Automated report"
            git push
          elif [[ $? -eq 0 ]]; then
            echo "No updates"
            exit 0
          else 
            echo "Exit with error code: $?"
            exit $?
          fi
      - run: echo "üçè This job's status is ${{ job.status }}."
